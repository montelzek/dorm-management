<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
  <div class="bg-card rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
    <div class="p-6 border-b border-card-border">
      <h2 class="text-2xl font-semibold text-text-primary">
        {{ (isEdit() ? 'admin.editAnnouncement' : 'admin.createAnnouncement') | translate }}
      </h2>
    </div>

    <form [formGroup]="form()" (ngSubmit)="onSubmit()" class="p-6 space-y-6">
      <!-- Title -->
      <div>
        <label for="title" class="block text-sm font-medium text-text-primary mb-1">
          {{ 'table.title' | translate }}
        </label>
        <input
          type="text"
          id="title"
          formControlName="title"
          class="w-full px-3 py-2 bg-card border border-card-border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-text-primary"
          [placeholder]="'admin.enterAnnouncementTitle' | translate"
        />
        @if (form().get('title')?.invalid && form().get('title')?.touched) {
          @if (form().get('title')?.hasError('required')) {
            <p class="mt-1 text-sm text-red-500">{{ 'validation.titleRequired' | translate }}</p>
          }
          @if (form().get('title')?.hasError('maxlength')) {
            <p class="mt-1 text-sm text-red-500">{{ 'admin.titleMaxLength' | translate }}</p>
          }
        }
      </div>

      <!-- Content -->
      <div>
        <label for="content" class="block text-sm font-medium text-text-primary mb-1">
          {{ 'announcements.announcementContent' | translate }}
        </label>
        <textarea
          id="content"
          formControlName="content"
          rows="4"
          class="w-full px-3 py-2 bg-card border border-card-border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-text-primary resize-none"
          [placeholder]="'admin.enterAnnouncementContent' | translate"
        ></textarea>
        @if (form().get('content')?.invalid && form().get('content')?.touched) {
          @if (form().get('content')?.hasError('required')) {
            <p class="mt-1 text-sm text-red-500">{{ 'admin.contentRequired' | translate }}</p>
          }
          @if (form().get('content')?.hasError('maxlength')) {
            <p class="mt-1 text-sm text-red-500">{{ 'admin.contentMaxLength' | translate }}</p>
          }
        }
      </div>

      <!-- Category -->
      <div>
        <label for="category" class="block text-sm font-medium text-text-primary mb-1">
          {{ 'table.category' | translate }}
        </label>
        <select
          id="category"
          formControlName="category"
          class="w-full px-3 py-2 bg-card border border-card-border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-text-primary"
        >
          <option value="">{{ 'issues.selectCategory' | translate }}</option>
          @for (cat of categories; track cat.value) {
            <option [value]="cat.value">{{ cat.label | translate }}</option>
          }
        </select>
        @if (form().get('category')?.invalid && form().get('category')?.touched) {
          <p class="mt-1 text-sm text-red-500">{{ 'admin.categoryRequired' | translate }}</p>
        }
      </div>

      <!-- Date Range -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="startDate" class="block text-sm font-medium text-text-primary mb-1">
            {{ 'announcements.startDate' | translate }}
          </label>
          <input
            type="date"
            id="startDate"
            formControlName="startDate"
            [min]="minDate()"
            class="w-full px-3 py-2 bg-card border border-card-border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-text-primary"
          />
          @if (form().get('startDate')?.invalid && form().get('startDate')?.touched) {
            <p class="mt-1 text-sm text-red-500">{{ 'admin.startDateRequired' | translate }}</p>
          }
        </div>

        <div>
          <label for="endDate" class="block text-sm font-medium text-text-primary mb-1">
            {{ 'announcements.endDate' | translate }}
          </label>
          <input
            type="date"
            id="endDate"
            formControlName="endDate"
            [min]="form().get('startDate')?.value || minDate()"
            class="w-full px-3 py-2 bg-card border border-card-border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-text-primary"
          />
          @if (form().get('endDate')?.invalid && form().get('endDate')?.touched) {
            <p class="mt-1 text-sm text-red-500">{{ 'admin.endDateRequired' | translate }}</p>
          }
        </div>
      </div>

      <!-- Buildings -->
      <div>
        <label class="block text-sm font-medium text-text-primary mb-2">
          {{ 'admin.targetBuildings' | translate }}
        </label>
        <div class="grid grid-cols-2 gap-3">
          @for (building of buildings(); track building.id) {
            <div
              (click)="toggleBuilding(building.id)"
              [class.bg-indigo-50]="isBuildingSelected(building.id)"
              [class.dark:bg-indigo-900/30]="isBuildingSelected(building.id)"
              [class.border-indigo-500]="isBuildingSelected(building.id)"
              class="p-3 border-2 border-card-border rounded-lg cursor-pointer hover:border-indigo-400 transition-colors"
            >
              <div class="flex items-center">
                <input
                  type="checkbox"
                  [checked]="isBuildingSelected(building.id)"
                  class="mr-2"
                  (click)="$event.stopPropagation()"
                  readonly
                />
                <span class="text-text-primary font-medium">{{ building.name }}</span>
              </div>
            </div>
          }
        </div>
        @if (form().get('buildingIds')?.invalid && form().get('buildingIds')?.touched) {
          <p class="mt-2 text-sm text-red-500">{{ 'admin.atLeastOneBuilding' | translate }}</p>
        }
      </div>

      <!-- Actions -->
      <div class="flex justify-end gap-3 pt-4 border-t border-card-border">
        <button
          type="button"
          (click)="onCancel()"
          class="px-4 py-2 text-text-secondary hover:bg-muted rounded-lg transition-colors"
          [disabled]="isLoading()"
        >
          {{ 'common.cancel' | translate }}
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="form().invalid || isLoading()"
        >
          {{ isLoading() ? ('common.saving' | translate) + '...' : ((isEdit() ? 'common.update' : 'common.create') | translate) }}
        </button>
      </div>
    </form>
  </div>
</div>


